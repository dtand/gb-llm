/**
 * @file    sprites.c
 * @brief   Tile data and initialization for Space Shooter
 * @game    shooter
 */

#include <gb/gb.h>
#include <stdint.h>
#include "sprites.h"

// ============================================================
// BACKGROUND TILES
// ============================================================

/** Empty tile (space background) */
const uint8_t empty_tile[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

/** Star tile (small dot) */
const uint8_t star_tile[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18,
    0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

/** Digit tiles 0-9 */
const uint8_t digit_tiles[] = {
    // 0
    0x3C, 0x3C, 0x66, 0x66, 0x6E, 0x6E, 0x76, 0x76,
    0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    // 1
    0x18, 0x18, 0x38, 0x38, 0x18, 0x18, 0x18, 0x18,
    0x18, 0x18, 0x18, 0x18, 0x7E, 0x7E, 0x00, 0x00,
    // 2
    0x3C, 0x3C, 0x66, 0x66, 0x06, 0x06, 0x1C, 0x1C,
    0x30, 0x30, 0x60, 0x60, 0x7E, 0x7E, 0x00, 0x00,
    // 3
    0x3C, 0x3C, 0x66, 0x66, 0x06, 0x06, 0x1C, 0x1C,
    0x06, 0x06, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    // 4
    0x0C, 0x0C, 0x1C, 0x1C, 0x3C, 0x3C, 0x6C, 0x6C,
    0x7E, 0x7E, 0x0C, 0x0C, 0x0C, 0x0C, 0x00, 0x00,
    // 5
    0x7E, 0x7E, 0x60, 0x60, 0x7C, 0x7C, 0x06, 0x06,
    0x06, 0x06, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    // 6
    0x1C, 0x1C, 0x30, 0x30, 0x60, 0x60, 0x7C, 0x7C,
    0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    // 7
    0x7E, 0x7E, 0x06, 0x06, 0x0C, 0x0C, 0x18, 0x18,
    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00, 0x00,
    // 8
    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C,
    0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    // 9
    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x3E,
    0x06, 0x06, 0x0C, 0x0C, 0x38, 0x38, 0x00, 0x00
};

/** Letter S */
const uint8_t letter_s_tile[] = {
    0x3C, 0x3C, 0x66, 0x66, 0x60, 0x60, 0x3C, 0x3C,
    0x06, 0x06, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00
};

/** Letter C */
const uint8_t letter_c_tile[] = {
    0x3C, 0x3C, 0x66, 0x66, 0x60, 0x60, 0x60, 0x60,
    0x60, 0x60, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00
};

/** Letter L */
const uint8_t letter_l_tile[] = {
    0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60,
    0x60, 0x60, 0x60, 0x60, 0x7E, 0x7E, 0x00, 0x00
};

/** Letter V */
const uint8_t letter_v_tile[] = {
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
    0x66, 0x66, 0x3C, 0x3C, 0x18, 0x18, 0x00, 0x00
};

/** Colon */
const uint8_t colon_tile[] = {
    0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00
};

// ============================================================
// SPRITE TILES
// ============================================================

/** Player ship metasprite (16x16 = 4 tiles) */
const uint8_t ship_tiles[] = {
    // Top-left: nose of ship
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x07, 0x07,
    // Top-right: nose of ship (mirrored)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xE0, 0xE0,
    // Bottom-left: body and wing
    0x0F, 0x0F, 0x1F, 0x1F, 0x3F, 0x3F, 0x7F, 0x7F,
    0xFF, 0xFF, 0x7F, 0x7F, 0x1F, 0x1F, 0x07, 0x07,
    // Bottom-right: body and wing (mirrored)
    0xF0, 0xF0, 0xF8, 0xF8, 0xFC, 0xFC, 0xFE, 0xFE,
    0xFF, 0xFF, 0xFE, 0xFE, 0xF8, 0xF8, 0xE0, 0xE0
};

/** Bullet tile (small vertical line) */
const uint8_t bullet_tile[] = {
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18
};

/** Enemy tile (simple invader shape) */
const uint8_t enemy_tile[] = {
    0x42, 0x42, 0x24, 0x24, 0x7E, 0x7E, 0xDB, 0xDB,
    0xFF, 0xFF, 0xBD, 0xBD, 0x24, 0x24, 0x42, 0x42
};

// ============================================================
// INITIALIZATION
// ============================================================

/**
 * @brief   Initialize all sprite and background tiles
 */
void sprites_init(void) {
    uint8_t i;
    
    // Load background tiles
    set_bkg_data(TILE_EMPTY, 1, empty_tile);
    set_bkg_data(TILE_STAR, 1, star_tile);
    set_bkg_data(TILE_DIGIT_0, 10, digit_tiles);
    set_bkg_data(TILE_S, 1, letter_s_tile);
    set_bkg_data(TILE_C, 1, letter_c_tile);
    set_bkg_data(TILE_L, 1, letter_l_tile);
    set_bkg_data(TILE_V, 1, letter_v_tile);
    set_bkg_data(TILE_COLON, 1, colon_tile);
    
    // Window uses same tile data as background
    // (they share the same tile memory)
    
    // Load sprite tiles
    set_sprite_data(TILE_SHIP_TL, 4, ship_tiles);
    set_sprite_data(TILE_BULLET, 1, bullet_tile);
    set_sprite_data(TILE_ENEMY, 1, enemy_tile);
    
    // Set up player metasprite (4 sprites)
    set_sprite_tile(SPRITE_PLAYER + 0, TILE_SHIP_TL);
    set_sprite_tile(SPRITE_PLAYER + 1, TILE_SHIP_TR);
    set_sprite_tile(SPRITE_PLAYER + 2, TILE_SHIP_BL);
    set_sprite_tile(SPRITE_PLAYER + 3, TILE_SHIP_BR);
    
    // Set up bullet sprites
    for (i = 0; i < 4; i++) {
        set_sprite_tile(SPRITE_BULLET_BASE + i, TILE_BULLET);
        move_sprite(SPRITE_BULLET_BASE + i, 0, 0);  // Hide initially
    }
    
    // Set up enemy sprites
    for (i = 0; i < 4; i++) {
        set_sprite_tile(SPRITE_ENEMY_BASE + i, TILE_ENEMY);
        move_sprite(SPRITE_ENEMY_BASE + i, 0, 0);  // Hide initially
    }
}
